!function n(i,c,a){function l(e,t){if(!c[e]){if(!i[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(u)return u(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var o=c[e]={exports:{}};i[e][0].call(o.exports,function(t){return l(i[e][1][t]||t)},o,o.exports,n,i,c,a)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({1:[function(r,t,s){!function(){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t,e=r(2);(t=e)&&t.__esModule;s.default={data:function(){return{el:"div",iconEmpty:{type:"check",back:"theme-empty"},icon:{type:"refresh",back:"theme-process"},processing:!1,completed:[],failed:[],errorMessage:String}},props:{message:String,messageEmpty:String,files:Array},computed:{count:function(){var t=this.files.length;return t=Object.is(t,void 0)?0:t,t},completedCount:function(){var t=this.completed.length;return t=Object.is(t,void 0)?0:t},imageString:function(){return 1==this.count?"image":"images"},isString:function(){return 1==this.count?"is":"are"},itString:function(){return 1==this.count?"it":"them"}},methods:{processImages:function(){var s=this;this.resetArrays(),this.processing=!0,this.files.forEach(function(r){s.$api.post("colorextractor/process-image",{id:r.id}).then(function(t){if(s.completed.push(r.name),s.completedCount==s.count)if(s.failed.length)s.failedExtraction();else{var e=s;setTimeout(function(){e.completedExtraction()},250)}s.setProgress()}).catch(function(t){s.completed.push(r.name),s.failed.push({name:r.filename,message:t.message}),s.completedCount==s.count&&s.failedExtraction(),s.setProgress()})})},setProgress:function(){var t=this.completedCount/this.count*100;t=Math.max(0,Math.min(100,t)),this.$refs.progress.set(t)},completedExtraction:function(){var t=this.completedCount+" images processed!";this.$refs.dialog.close(),this.$store.dispatch("notification/success",t),this.processing=!1,this.currentIndex=0,this.files={}},failedExtraction:function(){var t=this,e=1<this.failed.length?" errors.":" error.",r=this.completedCount+" images processed, with "+this.failed.length+e;this.errorMessage=r,this.processing=!1,this.currentIndex=0,this.files=this.files.filter(function(e){return t.failed.filter(function(t){return t.name===e.filename}).length})},openDialog:function(){this.resetArrays(),this.$refs.dialog.open()},abortExtraction:function(){this.$refs.dialog.close(),this.processing=!1},resetArrays:function(){this.completed=[],this.failed=[]}}}}(),t.exports.__esModule&&(t.exports=t.exports.default);var e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,t=r.$createElement,s=r._self._c||t;return s("k-field",r._b({},"k-field",r.$attrs,!1),[0==r.count?s("k-list-item",{staticClass:"colorextractor-empty",attrs:{text:r.messageEmpty,icon:r.iconEmpty,element:r.el}}):s("k-list-item",{staticClass:"colorextractor-button",attrs:{text:r.message,icon:r.icon,element:r.el},on:{click:r.openDialog}}),r._v(" "),s("k-dialog",{ref:"dialog",attrs:{theme:"negative"}},[r.processing||r.completedCount?!r.processing&&r.failed.length?[s("k-text",[r._v("\n\t    \t\t\t"+r._s(r.errorMessage)+"\n\t    \t\t")]),r._v(" "),s("ul",{staticClass:"colorextractor-errors"},r._l(r.failed,function(t,e){return s("li",{staticClass:"error"},[s("strong",[r._v("Filename:")]),r._v(" "+r._s(t.name)+"\n\t    \t\t\t\t"),s("div",{staticClass:"error-message"},[r._v(r._s(t.message))])])})),r._v(" "),s("template",{slot:"footer"},[s("k-button-group",[s("k-button",{attrs:{icon:"cancel"},on:{click:function(t){r.$refs.dialog.close()}}},[r._v("Close")])],1)],1)]:r.processing?[s("k-headline",[r._v("Processingâ€¦")]),r._v(" "),s("k-progress",{ref:"progress"}),r._v(" "),s("ul",{staticClass:"k-upload-list"},[s("div",{staticClass:"colorextractor-progress-caption"},[s("p",{staticClass:"k-colextractor-counter"},[r._v("Extracted: "+r._s(r.completedCount)+" / "+r._s(r.count))])])]),r._v(" "),s("template",{slot:"footer"},[s("k-button-group",[s("k-button",{attrs:{icon:"cancel"},on:{click:r.abortExtraction}},[r._v("Cancel")])],1)],1)]:r._e():[s("k-text",[r._v("\n\t    \t\t\tThere "+r._s(r.isString)+" "),s("strong",[r._v(r._s(r.count)+" "+r._s(r.imageString))]),r._v(" without any color extracted, do you want to process "+r._s(r.itString)+" now?\n\t    \t\t")]),r._v(" "),s("template",{slot:"footer"},[s("k-button-group",[s("k-button",{attrs:{icon:"cancel"},on:{click:function(t){r.$refs.dialog.close()}}},[r._v("Cancel")]),r._v(" "),s("k-button",{attrs:{icon:"check",theme:"positive"},on:{click:r.processImages}},[r._v("Process")])],1)],1)]],2)],1)},e.staticRenderFns=[]},{2:2}],2:[function(t,e,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(r,t){var s=Object.assign({url:"plugins/colorextractor/process-image",accept:"text",attributes:{},complete:function(){},error:function(){},success:function(){},progress:function(){}},t),e=new FormData;e.append("id",r.id),s.attributes&&Object.keys(s.attributes).forEach(function(t){e.append(t,s.attributes[t])});var o=new XMLHttpRequest;o.addEventListener("load",function(t){var e=null;try{e=JSON.parse(t.target.response)}catch(t){e={status:"error",message:"The file could not be updated"}}e.status&&"error"===e.status?s.error(o,r,e):s.success(o,r,e)}),o.addEventListener("error",function(t){var e=JSON.parse(t.target.response);s.error(o,r,e),s.progress(o,r,100)}),o.open("POST",s.url,!0),o.send(e)}},{}],3:[function(t,e,r){"use strict";var s,o=t(1),n=(s=o)&&s.__esModule?s:{default:s};panel.plugin("sylvainjule/colorextractor",{fields:{colorextractor:n.default}})},{1:1}]},{},[3]);
